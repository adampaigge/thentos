<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Thentos.Action.Core</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Thentos-Action-Core.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">thentos-core-0.0.1.1: The swiss army knife of privacy-preserving identity management</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Thentos.Action.Core</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">types</a></li><li><a href="#g:2">running actions</a></li><li><a href="#g:3">labels, privileges and access rights.</a></li><li><a href="#g:4">TCB business</a></li><li><a href="#g:5">better label errors</a></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">newtype</span> <a href="#t:ActionState">ActionState</a> = <a href="#v:ActionState">ActionState</a> {<ul class="subs"><li><a href="#v:fromActionState">fromActionState</a> :: (Pool Connection, <a href=""/>MVar</a> ChaChaDRG, <a href="Thentos-Config.html#t:ThentosConfig">ThentosConfig</a>)</li></ul>}</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:Action">Action</a> e s a = <a href="#v:Action">Action</a> {<ul class="subs"><li><a href="#v:fromAction">fromAction</a> :: <a href=""/>ReaderT</a> <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> (EitherT (<a href="Thentos-Types.html#t:ThentosError">ThentosError</a> e) (<a href=""/>StateT</a> s (LIO DCLabel))) a</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:ActionError">ActionError</a> e<ul class="subs"><li>= <a href="#v:ActionErrorThentos">ActionErrorThentos</a> (<a href="Thentos-Types.html#t:ThentosError">ThentosError</a> e)</li><li>| <a href="#v:ActionErrorAnyLabel">ActionErrorAnyLabel</a> AnyLabelError</li><li>| <a href="#v:ActionErrorUnknown">ActionErrorUnknown</a> <a href=""/>SomeException</a></li></ul></li><li class="src short"><a href="#v:runAction">runAction</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</li><li class="src short"><a href="#v:runActionWithPrivs">runActionWithPrivs</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; [CNF] -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</li><li class="src short"><a href="#v:runActionWithClearance">runActionWithClearance</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; DCLabel -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</li><li class="src short"><a href="#v:runActionAsAgent">runActionAsAgent</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</li><li class="src short"><a href="#v:runActionInThentosSession">runActionInThentosSession</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</li><li class="src short"><a href="#v:runActionE">runActionE</a> :: <span class="keyword">forall</span> s e a. (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</li><li class="src short"><a href="#v:runActionWithPrivsE">runActionWithPrivsE</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; [CNF] -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</li><li class="src short"><a href="#v:runActionWithClearanceE">runActionWithClearanceE</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; DCLabel -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</li><li class="src short"><a href="#v:runActionAsAgentE">runActionAsAgentE</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</li><li class="src short"><a href="#v:runActionInThentosSessionE">runActionInThentosSessionE</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</li><li class="src short"><a href="#v:grantAccessRights-39-P">grantAccessRights'P</a> :: [CNF] -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:accessRightsByAgent-39-P">accessRightsByAgent'P</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [CNF]</li><li class="src short"><a href="#v:accessRightsByThentosSession-39-P">accessRightsByThentosSession'P</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [CNF]</li><li class="src short"><a href="#v:query-39-P">query'P</a> :: <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e v -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s v</li><li class="src short"><a href="#v:getConfig-39-P">getConfig'P</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Config.html#t:ThentosConfig">ThentosConfig</a></li><li class="src short"><a href="#v:getCurrentTime-39-P">getCurrentTime'P</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:Timestamp">Timestamp</a></li><li class="src short"><a href="#v:genRandomBytes-39-P">genRandomBytes'P</a> :: <a href=""/>Int</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s SBS</li><li class="src short"><a href="#v:makeUserFromFormData-39-P">makeUserFromFormData'P</a> :: <a href="Thentos-Types.html#t:UserFormData">UserFormData</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:User">User</a></li><li class="src short"><a href="#v:hashUserPass-39-P">hashUserPass'P</a> :: <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:UserPass">UserPass</a>)</li><li class="src short"><a href="#v:hashServiceKey-39-P">hashServiceKey'P</a> :: <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a>)</li><li class="src short"><a href="#v:sendMail-39-P">sendMail'P</a> :: <a href="Thentos-Config.html#t:SmtpConfig">SmtpConfig</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:UserName">UserName</a> -&gt; <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; ST -&gt; ST -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:renderTextTemplate-39-P">renderTextTemplate'P</a> :: ST -&gt; MuContext <a href=""/>IO</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s LT</li><li class="src short"><a href="#v:logger-39-P">logger'P</a> :: Priority -&gt; <a href=""/>String</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:logIfError-39-P">logIfError'P</a> :: <span class="keyword">forall</span> m l e v f s. (m ~ <a href="Thentos-Action-Core.html#t:Action">Action</a> f s, <a href=""/>Monad</a> m, MonadLIO l m, MonadError e m, <a href=""/>Show</a> e, <a href=""/>Show</a> f) =&gt; m v -&gt; m v</li><li class="src short"><a href="#v:taintMsg">taintMsg</a> :: <a href=""/>String</a> -&gt; DCLabel -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:guardWriteMsg">guardWriteMsg</a> :: <a href=""/>String</a> -&gt; DCLabel -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li></ul></div><div id="interface"><h1 id="g:1">types</h1><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:ActionState" class="def">ActionState</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:ActionState" class="def">ActionState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:fromActionState" class="def">fromActionState</a> :: (Pool Connection, <a href=""/>MVar</a> ChaChaDRG, <a href="Thentos-Config.html#t:ThentosConfig">ThentosConfig</a>)</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:ActionState" class="caption collapser" onclick="toggleSection('i:ActionState')">Instances</p><div id="section.i:ActionState" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href=""/>Generic</a> <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a></span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">MonadReader <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">MonadReader <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> (<a href="Thentos-Action-SimpleAuth.html#t:UnsafeAction">UnsafeAction</a> e s)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">type</span> <a href=""/>Rep</a> <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a></span></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:Action" class="def">Action</a> e s a</p><div class="doc"><p>The <code><a href="Thentos-Action-Core.html#t:Action">Action</a></code> monad transformer stack.  It contains:</p><ul><li><code>LIO</code> as a base monad.</li><li>A state of polymorphic type (for use e.g. by the frontend handlers to store cookies etc.)</li><li>The option of throwing <code>ThentosError e</code>.  (Not 'ActionError e', which contains
       authorization errors that must not be catchable from inside an <code><a href="Thentos-Action-Core.html#t:Action">Action</a></code>.)</li><li>An <code><a href="Thentos-Action-Core.html#t:ActionState">ActionState</a></code> in a reader.  The state can be used by actions for calls to <code>LIO</code>, which
       will have authorized effect.  Since it is contained in a reader, actions do not have the
       power to corrupt it.</li></ul></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Action" class="def">Action</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:fromAction" class="def">fromAction</a> :: <a href=""/>ReaderT</a> <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> (EitherT (<a href="Thentos-Types.html#t:ThentosError">ThentosError</a> e) (<a href=""/>StateT</a> s (LIO DCLabel))) a</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Action" class="caption collapser" onclick="toggleSection('i:Action')">Instances</p><div id="section.i:Action" class="show"><table><tr><td class="src clearfix"><span class="inst-left">MonadLIO DCLabel (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">MonadReader <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">MonadState s (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">MonadError (<a href="Thentos-Types.html#t:ThentosError">ThentosError</a> e) (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href=""/>Monad</a> (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href=""/>Functor</a> (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href=""/>Applicative</a> (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href=""/>Generic</a> (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s a)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">type</span> <a href=""/>Rep</a> (<a href="Thentos-Action-Core.html#t:Action">Action</a> e s a)</span></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:ActionError" class="def">ActionError</a> e</p><div class="doc"><p>Errors known by <code><a href="Thentos-Action-Core.html#v:runActionE">runActionE</a></code>, <code><a href="Thentos-Action-Core.html#v:runAction">runAction</a></code>, ....</p><p>The <code>MonadError</code> instance of newtype <code><a href="Thentos-Action-Core.html#t:Action">Action</a></code> lets you throw and catch errors from *within* the
 <code><a href="Thentos-Action-Core.html#t:Action">Action</a></code>, i.e., at construction time).  These are errors are handled in the <code><a href="Thentos-Action-Core.html#v:ActionErrorThentos">ActionErrorThentos</a></code>
 constructor.  Label errors and other (possibly async) exceptions are caught (if possible) in
 <code><a href="Thentos-Action-Core.html#v:runActionE">runActionE</a></code> and its friends and maintained in other <code><a href="Thentos-Action-Core.html#t:ActionError">ActionError</a></code> constructors.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:ActionErrorThentos" class="def">ActionErrorThentos</a> (<a href="Thentos-Types.html#t:ThentosError">ThentosError</a> e)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:ActionErrorAnyLabel" class="def">ActionErrorAnyLabel</a> AnyLabelError</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:ActionErrorUnknown" class="def">ActionErrorUnknown</a> <a href=""/>SomeException</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:ActionError" class="caption collapser" onclick="toggleSection('i:ActionError')">Instances</p><div id="section.i:ActionError" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href=""/>Show</a> e =&gt; <a href=""/>Show</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">(<a href=""/>Show</a> e, <a href=""/>Typeable</a> * e) =&gt; <a href=""/>Exception</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e)</span></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h1 id="g:2">running actions</h1><div class="top"><p class="src"><a name="v:runAction" class="def">runAction</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</p><div class="doc"><p>Call <code><a href="Thentos-Action-Core.html#v:runActionE">runActionE</a></code> and throw <code><a href=""/>Left</a></code> values.</p></div></div><div class="top"><p class="src"><a name="v:runActionWithPrivs" class="def">runActionWithPrivs</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; [CNF] -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</p></div><div class="top"><p class="src"><a name="v:runActionWithClearance" class="def">runActionWithClearance</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; DCLabel -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</p></div><div class="top"><p class="src"><a name="v:runActionAsAgent" class="def">runActionAsAgent</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</p></div><div class="top"><p class="src"><a name="v:runActionInThentosSession" class="def">runActionInThentosSession</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (a, s)</p></div><div class="top"><p class="src"><a name="v:runActionE" class="def">runActionE</a> :: <span class="keyword">forall</span> s e a. (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</p><div class="doc"><p>Call an action with no access rights.  Catch all errors.  Initial LIO state is not
 <code>dcDefaultState</code>, but <code>LIOState dcBottom dcBottom</code>: Only actions that require no clearance can be
 executed, and the label has not been guarded by any action yet.</p><p>Updates to the polymorphic state inside the action are effective in the result if there are no
 exceptions or if a <code><a href="Thentos-Types.html#t:ThentosError">ThentosError</a></code> is thrown, but NOT if any other exceptions (such as
 <code>AnyLabelError</code>) are thrown.</p></div></div><div class="top"><p class="src"><a name="v:runActionWithPrivsE" class="def">runActionWithPrivsE</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; [CNF] -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</p></div><div class="top"><p class="src"><a name="v:runActionWithClearanceE" class="def">runActionWithClearanceE</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; DCLabel -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</p></div><div class="top"><p class="src"><a name="v:runActionAsAgentE" class="def">runActionAsAgentE</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</p></div><div class="top"><p class="src"><a name="v:runActionInThentosSessionE" class="def">runActionInThentosSessionE</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; s -&gt; <a href="Thentos-Action-Core.html#t:ActionState">ActionState</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s a -&gt; <a href=""/>IO</a> (<a href=""/>Either</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) a, s)</p></div><h1 id="g:3">labels, privileges and access rights.</h1><div class="top"><p class="src"><a name="v:grantAccessRights-39-P" class="def">grantAccessRights'P</a> :: [CNF] -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>In order to execute an <code><a href="Thentos-Action-Core.html#t:Action">Action</a></code>, certain access rights need to be granted.  A set of access
 rights is a list of <code>ToCNF</code> instances that are used to update the current clearance in the
 <code>LIOState</code> in the <code>LIO</code> monad underlying <code><a href="Thentos-Action-Core.html#t:Action">Action</a></code>.</p><p>To execute an <code><a href="Thentos-Action-Core.html#t:Action">Action</a></code> with the access rights of <code><a href="Thentos-Types.html#t:UserId">UserId</a></code> <code>u</code> and <code>BasicRole</code> <code>r</code>:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>grantAccessRights'P [toCNF u, toCNF r]
</code></strong></pre><p>Or, to grant just <code>r</code>:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>grantAccessRights'P [r]
</code></strong></pre><p>Adding more access rights must increase access, so for a list <code>ars</code> of access rights, the
 constructed clearance level <code>c</code> must satisfy:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>and [ (ar %% ar) `canFlowTo` c | ar &lt;- ars ]
</code></strong></pre><p>Therefore, <code>c</code> is defined as the least upper bound (join) of the labels constructed from
 individual access rights:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>c = foldl' (lub) dcBottom [ ar %% ar | ar &lt;- ars ]
</code></strong></pre></div></div><div class="top"><p class="src"><a name="v:accessRightsByAgent-39-P" class="def">accessRightsByAgent'P</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [CNF]</p><div class="doc"><p>Construct a <code>DCLabel</code> from agent's roles.</p></div></div><div class="top"><p class="src"><a name="v:accessRightsByThentosSession-39-P" class="def">accessRightsByThentosSession'P</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [CNF]</p></div><h1 id="g:4">TCB business</h1><div class="top"><p class="src"><a name="v:query-39-P" class="def">query'P</a> :: <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e v -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s v</p></div><div class="top"><p class="src"><a name="v:getConfig-39-P" class="def">getConfig'P</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Config.html#t:ThentosConfig">ThentosConfig</a></p></div><div class="top"><p class="src"><a name="v:getCurrentTime-39-P" class="def">getCurrentTime'P</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:Timestamp">Timestamp</a></p></div><div class="top"><p class="src"><a name="v:genRandomBytes-39-P" class="def">genRandomBytes'P</a> :: <a href=""/>Int</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s SBS</p><div class="doc"><p>A relative of <code>cprgGenerate</code> from crypto-random that lives in
 <code><a href="Thentos-Action-Core.html#t:Action">Action</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:makeUserFromFormData-39-P" class="def">makeUserFromFormData'P</a> :: <a href="Thentos-Types.html#t:UserFormData">UserFormData</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:User">User</a></p></div><div class="top"><p class="src"><a name="v:hashUserPass-39-P" class="def">hashUserPass'P</a> :: <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:UserPass">UserPass</a>)</p></div><div class="top"><p class="src"><a name="v:hashServiceKey-39-P" class="def">hashServiceKey'P</a> :: <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a>)</p></div><div class="top"><p class="src"><a name="v:sendMail-39-P" class="def">sendMail'P</a> :: <a href="Thentos-Config.html#t:SmtpConfig">SmtpConfig</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:UserName">UserName</a> -&gt; <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; ST -&gt; ST -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p></div><div class="top"><p class="src"><a name="v:renderTextTemplate-39-P" class="def">renderTextTemplate'P</a> :: ST -&gt; MuContext <a href=""/>IO</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s LT</p><div class="doc"><p>Render a Hastache template for plain-text output (none of the characters in context variables
 will be escaped).</p></div></div><div class="top"><p class="src"><a name="v:logger-39-P" class="def">logger'P</a> :: Priority -&gt; <a href=""/>String</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p></div><div class="top"><p class="src"><a name="v:logIfError-39-P" class="def">logIfError'P</a> :: <span class="keyword">forall</span> m l e v f s. (m ~ <a href="Thentos-Action-Core.html#t:Action">Action</a> f s, <a href=""/>Monad</a> m, MonadLIO l m, MonadError e m, <a href=""/>Show</a> e, <a href=""/>Show</a> f) =&gt; m v -&gt; m v</p><div class="doc"><p>(This type signature could be greatly simplified, but that would also make it less explanatory.)</p></div></div><h1 id="g:5">better label errors</h1><div class="top"><p class="src"><a name="v:taintMsg" class="def">taintMsg</a> :: <a href=""/>String</a> -&gt; DCLabel -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Call <code>taint</code>, but log a more informative error in case of fail.</p></div></div><div class="top"><p class="src"><a name="v:guardWriteMsg" class="def">guardWriteMsg</a> :: <a href=""/>String</a> -&gt; DCLabel -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>