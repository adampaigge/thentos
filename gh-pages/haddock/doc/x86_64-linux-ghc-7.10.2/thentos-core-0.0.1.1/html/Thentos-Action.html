<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Thentos.Action</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Thentos-Action.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">thentos-core-0.0.1.1: The swiss army knife of privacy-preserving identity management</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Thentos.Action</p></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:freshRandomName">freshRandomName</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ST</li><li class="src short"><a href="#v:freshRandom20">freshRandom20</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:Random20">Random20</a></li><li class="src short"><a href="#v:freshConfirmationToken">freshConfirmationToken</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a></li><li class="src short"><a href="#v:freshPasswordResetToken">freshPasswordResetToken</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a></li><li class="src short"><a href="#v:freshServiceId">freshServiceId</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceId">ServiceId</a></li><li class="src short"><a href="#v:freshServiceKey">freshServiceKey</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a></li><li class="src short"><a href="#v:freshSessionToken">freshSessionToken</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a></li><li class="src short"><a href="#v:freshServiceSessionToken">freshServiceSessionToken</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a></li><li class="src short"><a href="#v:lookupConfirmedUser">lookupConfirmedUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</li><li class="src short"><a href="#v:lookupConfirmedUserByName">lookupConfirmedUserByName</a> :: <a href="Thentos-Types.html#t:UserName">UserName</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</li><li class="src short"><a href="#v:lookupConfirmedUserByEmail">lookupConfirmedUserByEmail</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</li><li class="src short"><a href="#v:addUser">addUser</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:UserFormData">UserFormData</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:UserId">UserId</a></li><li class="src short"><a href="#v:deleteUser">deleteUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:addUnconfirmedUser">addUnconfirmedUser</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:UserFormData">UserFormData</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a>)</li><li class="src short"><a href="#v:confirmNewUser">confirmNewUser</a> :: <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a>)</li><li class="src short"><a href="#v:addPasswordResetToken">addPasswordResetToken</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:User">User</a>, <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a>)</li><li class="src short"><a href="#v:resetPassword">resetPassword</a> :: <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:changePassword">changePassword</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:_changePasswordUnconditionally">_changePasswordUnconditionally</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:requestUserEmailChange">requestUserEmailChange</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; (<a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; ST) -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:confirmUserEmailChange">confirmUserEmailChange</a> :: <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:allServiceIds">allServiceIds</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>]</li><li class="src short"><a href="#v:lookupService">lookupService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>, <a href="Thentos-Types.html#t:Service">Service</a>)</li><li class="src short"><a href="#v:addService">addService</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceName">ServiceName</a> -&gt; <a href="Thentos-Types.html#t:ServiceDescription">ServiceDescription</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>, <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a>)</li><li class="src short"><a href="#v:deleteService">deleteService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:autocreateServiceIfMissing-39-P">autocreateServiceIfMissing'P</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:addPersona">addPersona</a> :: <a href="Thentos-Types.html#t:PersonaName">PersonaName</a> -&gt; <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:Uri">Uri</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:Persona">Persona</a></li><li class="src short"><a href="#v:deletePersona">deletePersona</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:addContext">addContext</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Types.html#t:ContextDescription">ContextDescription</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:ProxyUri">ProxyUri</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:Context">Context</a></li><li class="src short"><a href="#v:deleteContext">deleteContext</a> :: <a href="Thentos-Types.html#t:Context">Context</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:registerPersonaWithContext">registerPersonaWithContext</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:unregisterPersonaFromContext">unregisterPersonaFromContext</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:findPersona">findPersona</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href=""/>Maybe</a> <a href="Thentos-Types.html#t:Persona">Persona</a>)</li><li class="src short"><a href="#v:contextsForService">contextsForService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:Context">Context</a>]</li><li class="src short"><a href="#v:addPersonaToGroup">addPersonaToGroup</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:removePersonaFromGroup">removePersonaFromGroup</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:addGroupToGroup">addGroupToGroup</a> :: <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:removeGroupFromGroup">removeGroupFromGroup</a> :: <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:personaGroups">personaGroups</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:Group">Group</a>]</li><li class="src short"><a href="#v:defaultSessionTimeout">defaultSessionTimeout</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a></li><li class="src short"><a href="#v:lookupThentosSession">lookupThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ThentosSession">ThentosSession</a></li><li class="src short"><a href="#v:existsThentosSession">existsThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href=""/>Bool</a></li><li class="src short"><a href="#v:startThentosSessionByUserId">startThentosSessionByUserId</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a></li><li class="src short"><a href="#v:startThentosSessionByUserName">startThentosSessionByUserName</a> :: <a href="Thentos-Types.html#t:UserName">UserName</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a>)</li><li class="src short"><a href="#v:startThentosSessionByUserEmail">startThentosSessionByUserEmail</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a>)</li><li class="src short"><a href="#v:startThentosSessionByServiceId">startThentosSessionByServiceId</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a></li><li class="src short"><a href="#v:endThentosSession">endThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:validateThentosUserSession">validateThentosUserSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</li><li class="src short"><a href="#v:serviceNamesFromThentosSession">serviceNamesFromThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:ServiceName">ServiceName</a>]</li><li class="src short"><a href="#v:lookupServiceSession">lookupServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceSession">ServiceSession</a></li><li class="src short"><a href="#v:existsServiceSession">existsServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href=""/>Bool</a></li><li class="src short"><a href="#v:addServiceRegistration">addServiceRegistration</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:dropServiceRegistration">dropServiceRegistration</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:startServiceSession">startServiceSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a></li><li class="src short"><a href="#v:endServiceSession">endServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:getServiceSessionMetadata">getServiceSessionMetadata</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceSessionMetadata">ServiceSessionMetadata</a></li><li class="src short"><a href="#v:assignRole">assignRole</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Role">Role</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:unassignRole">unassignRole</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Role">Role</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li><li class="src short"><a href="#v:agentRoles">agentRoles</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:Role">Role</a>]</li><li class="src short"><a href="#v:makeCaptcha">makeCaptcha</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a>, <a href="Thentos-Types.html#t:ImageData">ImageData</a>)</li><li class="src short"><a href="#v:solveCaptcha">solveCaptcha</a> :: <a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a> -&gt; ST -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href=""/>Bool</a></li><li class="src short"><a href="#v:collectGarbage">collectGarbage</a> :: <a href=""/>Exception</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) =&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a name="v:freshRandomName" class="def">freshRandomName</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ST</p><div class="doc"><p>Return a base64 encoded random string of length 24 (18 bytes of entropy).
 We use <code>_</code> instead of <code>/</code> as last letter of the base64 alphabet since it allows using names
 within URLs without percent-encoding. Our Base64 alphabet thus consists of ASCII letters +
 digits as well as <code>+</code> and <code>_</code>. All of these are reliably recognized in URLs, even if they occur
 at the end.</p><p>RFC 4648 also has a &quot;URL Safe Alphabet&quot; which additionally replaces <code>+</code> by <code>-</code>. But that's
 problematic, since <code>-</code> at the end of URLs is not recognized as part of the URL by some programs
 such as Thunderbird.</p></div></div><div class="top"><p class="src"><a name="v:freshRandom20" class="def">freshRandom20</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:Random20">Random20</a></p><div class="doc"><p>Generate 20 bytes of random data.
 For comparison: an UUID has 16 bytes, so that should be enough for all practical purposes.</p></div></div><div class="top"><p class="src"><a name="v:freshConfirmationToken" class="def">freshConfirmationToken</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a></p></div><div class="top"><p class="src"><a name="v:freshPasswordResetToken" class="def">freshPasswordResetToken</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a></p></div><div class="top"><p class="src"><a name="v:freshServiceId" class="def">freshServiceId</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceId">ServiceId</a></p></div><div class="top"><p class="src"><a name="v:freshServiceKey" class="def">freshServiceKey</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a></p></div><div class="top"><p class="src"><a name="v:freshSessionToken" class="def">freshSessionToken</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a></p></div><div class="top"><p class="src"><a name="v:freshServiceSessionToken" class="def">freshServiceSessionToken</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a></p></div><div class="top"><p class="src"><a name="v:lookupConfirmedUser" class="def">lookupConfirmedUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</p><div class="doc"><p>Return a user with its id.  Requires or privileges of admin or the user that is looked up.  If
 no user is found or access is not granted, throw <code><a href="Thentos-Types.html#v:NoSuchUser">NoSuchUser</a></code>.  See <code>_lookupUserCheckPassword</code> for
 user lookup prior to authentication.</p></div></div><div class="top"><p class="src"><a name="v:lookupConfirmedUserByName" class="def">lookupConfirmedUserByName</a> :: <a href="Thentos-Types.html#t:UserName">UserName</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</p><div class="doc"><p>Like <code><a href="Thentos-Action.html#v:lookupConfirmedUser">lookupConfirmedUser</a></code>, but based on <code><a href="Thentos-Types.html#t:UserName">UserName</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:lookupConfirmedUserByEmail" class="def">lookupConfirmedUserByEmail</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</p><div class="doc"><p>Like <code><a href="Thentos-Action.html#v:lookupConfirmedUser">lookupConfirmedUser</a></code>, but based on <code><a href="Thentos-Types.html#t:UserEmail">UserEmail</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:addUser" class="def">addUser</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:UserFormData">UserFormData</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:UserId">UserId</a></p><div class="doc"><p>Add a user based on its form data.  Requires <code><a href="Thentos-Types.html#v:RoleAdmin">RoleAdmin</a></code>.  For creating users with e-mail
 verification, see <code><a href="Thentos-Action.html#v:addUnconfirmedUser">addUnconfirmedUser</a></code>, <code><a href="Thentos-Action.html#v:confirmNewUser">confirmNewUser</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:deleteUser" class="def">deleteUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Delete user.  Requires or privileges of admin or the user that is looked up.  If no user is
 found or access is not granted, throw <code><a href="Thentos-Types.html#v:NoSuchUser">NoSuchUser</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:addUnconfirmedUser" class="def">addUnconfirmedUser</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:UserFormData">UserFormData</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a>)</p><div class="doc"><p>Initiate email-verified user creation.  Does not require any privileges.  See also:
 <code><a href="Thentos-Action.html#v:confirmNewUser">confirmNewUser</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:confirmNewUser" class="def">confirmNewUser</a> :: <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a>)</p><div class="doc"><p>Finish email-verified user creation. Throws <code><a href="Thentos-Types.html#v:NoSuchPendingUserConfirmation">NoSuchPendingUserConfirmation</a></code> if the
 token doesn't exist or is expired.</p><p>SECURITY: As a caller, you have to make sure the token has been produced by the legitimate
 recipient of a confirmation email.  Authentication can only be provided by this api **after** the
 user has been created by calling this function.</p><p>See also: <code><a href="Thentos-Action.html#v:addUnconfirmedUser">addUnconfirmedUser</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:addPasswordResetToken" class="def">addPasswordResetToken</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:User">User</a>, <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a>)</p><div class="doc"><p>Initiate password reset with email confirmation.  No authentication required, obviously.</p></div></div><div class="top"><p class="src"><a name="v:resetPassword" class="def">resetPassword</a> :: <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Finish password reset with email confirmation.</p><p>SECURITY: See <code><a href="Thentos-Action.html#v:confirmNewUser">confirmNewUser</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:changePassword" class="def">changePassword</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Authenticate user against old password, and then change password to new password.</p><p>LIO policy: In addition to the old password as proof of authority, this function requires the
 user to change the password to be logged in (or admin privs).</p></div></div><div class="top"><p class="src"><a name="v:_changePasswordUnconditionally" class="def">_changePasswordUnconditionally</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p></div><div class="top"><p class="src"><a name="v:requestUserEmailChange" class="def">requestUserEmailChange</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; (<a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; ST) -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Initiate email change by creating and storing a token and sending it out by email to the old
 address of the user.  This requires <code><a href="Thentos-Types.html#v:RoleAdmin">RoleAdmin</a></code> or privs of email address owner, but the address
 is only changed after a call to <code><a href="Thentos-Action.html#v:confirmUserEmailChange">confirmUserEmailChange</a></code> with the correct token.</p></div></div><div class="top"><p class="src"><a name="v:confirmUserEmailChange" class="def">confirmUserEmailChange</a> :: <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Look up the given confirmation token and updates the user's email address iff 1) the token
 exists, 2) the token belongs to the user currently logged in, and 3) the token has not
 expired. If any of these conditions don't apply, throw <code><a href="Thentos-Types.html#v:NoSuchToken">NoSuchToken</a></code> to avoid leaking
 information.</p><p>SECURITY: The security information from <code><a href="Thentos-Action.html#v:confirmNewUser">confirmNewUser</a></code> does not directly apply here: the
 attacker needs to fulfil **all** three conditions mentioned above for a successful attack, not
 only token secrecy.</p></div></div><div class="top"><p class="src"><a name="v:allServiceIds" class="def">allServiceIds</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>]</p></div><div class="top"><p class="src"><a name="v:lookupService" class="def">lookupService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>, <a href="Thentos-Types.html#t:Service">Service</a>)</p></div><div class="top"><p class="src"><a name="v:addService" class="def">addService</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceName">ServiceName</a> -&gt; <a href="Thentos-Types.html#t:ServiceDescription">ServiceDescription</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>, <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a>)</p></div><div class="top"><p class="src"><a name="v:deleteService" class="def">deleteService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p></div><div class="top"><p class="src"><a name="v:autocreateServiceIfMissing-39-P" class="def">autocreateServiceIfMissing'P</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Autocreate a service with a specific ID if it doesn't exist yet. Moreover, if no contexts
 have been defined for the service yet, a default context with empty name is automatically
 created.</p><p>This allows adding services to the config which will automatically spring into life if the
 config is read.</p></div></div><div class="top"><p class="src"><a name="v:addPersona" class="def">addPersona</a> :: <a href="Thentos-Types.html#t:PersonaName">PersonaName</a> -&gt; <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:Uri">Uri</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:Persona">Persona</a></p><div class="doc"><p>Add a new persona to the DB. A persona has a unique name and a user to which it belongs.
 The <code><a href="Thentos-Types.html#t:PersonaId">PersonaId</a></code> is assigned by the DB. May throw <code><a href="Thentos-Types.html#v:NoSuchUser">NoSuchUser</a></code> or <code><a href="Thentos-Types.html#v:PersonaNameAlreadyExists">PersonaNameAlreadyExists</a></code>.
 Only the user owning the persona or an admin may do this.</p></div></div><div class="top"><p class="src"><a name="v:deletePersona" class="def">deletePersona</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Delete a persona. Throw <code><a href="Thentos-Types.html#v:NoSuchPersona">NoSuchPersona</a></code> if the persona does not exist in the DB.
 Only the user owning the persona or an admin may do this.</p></div></div><div class="top"><p class="src"><a name="v:addContext" class="def">addContext</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Types.html#t:ContextDescription">ContextDescription</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:ProxyUri">ProxyUri</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:Context">Context</a></p><div class="doc"><p>Add a new context. The first argument identifies the service to which the context belongs.
 May throw <code><a href="Thentos-Types.html#v:NoSuchService">NoSuchService</a></code> or <code><a href="Thentos-Types.html#v:ContextNameAlreadyExists">ContextNameAlreadyExists</a></code>.
 Only the service or an admin may do this.</p></div></div><div class="top"><p class="src"><a name="v:deleteContext" class="def">deleteContext</a> :: <a href="Thentos-Types.html#t:Context">Context</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Delete a context. Throw an error if the context does not exist in the DB.
 Only the service owning the context or an admin may do this.</p></div></div><div class="top"><p class="src"><a name="v:registerPersonaWithContext" class="def">registerPersonaWithContext</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Connect a persona with a context. Throws an error if the persona is already registered for the
 context or if the user has any *other* persona registered for the context
 (<code><a href="Thentos-Types.html#v:MultiplePersonasPerContext">MultiplePersonasPerContext</a></code>). (As we currently allow only one persona per user and context.)
 Throws <code><a href="Thentos-Types.html#v:NoSuchPersona">NoSuchPersona</a></code> or <code><a href="Thentos-Types.html#v:NoSuchContext">NoSuchContext</a></code> if one of the arguments doesn't exist.
 Only the user owning the persona or an admin may do this.</p></div></div><div class="top"><p class="src"><a name="v:unregisterPersonaFromContext" class="def">unregisterPersonaFromContext</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Unregister a persona from accessing a context. No-op if the persona was not registered for the
 context. Only the user owning the persona or an admin may do this.</p></div></div><div class="top"><p class="src"><a name="v:findPersona" class="def">findPersona</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href=""/>Maybe</a> <a href="Thentos-Types.html#t:Persona">Persona</a>)</p><div class="doc"><p>Find the persona that a user wants to use for a context (if any).
 Only the user owning the persona or an admin may do this.</p></div></div><div class="top"><p class="src"><a name="v:contextsForService" class="def">contextsForService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:Context">Context</a>]</p><div class="doc"><p>List all contexts owned by a service. Anybody may do this.</p></div></div><div class="top"><p class="src"><a name="v:addPersonaToGroup" class="def">addPersonaToGroup</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Add a persona to a group. If the persona is already a member of the group, do nothing.
 Only a GroupAdmin may do this.</p></div></div><div class="top"><p class="src"><a name="v:removePersonaFromGroup" class="def">removePersonaFromGroup</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Remove a persona from a group. If the persona is not a member of the group, do nothing.
 Only a GroupAdmin may do this.</p></div></div><div class="top"><p class="src"><a name="v:addGroupToGroup" class="def">addGroupToGroup</a> :: <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Add a group (subgroup) to another group (supergroup) so that all members of subgroup will also
 be considered members of supergroup. If subgroup is already a direct member of supergroup, do
 nothing. Throws <code><a href="Thentos-Types.html#v:GroupMembershipLoop">GroupMembershipLoop</a></code> if adding the relation would cause a loop.
 Only a GroupAdmin may do this.</p></div></div><div class="top"><p class="src"><a name="v:removeGroupFromGroup" class="def">removeGroupFromGroup</a> :: <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Remove a group (subgroup) from another group (supergroup). If subgroup is not a direct
 member of supergroup, do nothing. Only a GroupAdmin may do this.</p></div></div><div class="top"><p class="src"><a name="v:personaGroups" class="def">personaGroups</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:Group">Group</a>]</p><div class="doc"><p>List all groups a persona belongs to, directly or indirectly. If p is a member of g1,
 g1 is a member of g2, and g2 is a member of g3, [g1, g2, g3] will be returned.
 Only the user owning the persona or a GroupAdmin may do this.</p></div></div><div class="top"><p class="src"><a name="v:defaultSessionTimeout" class="def">defaultSessionTimeout</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a></p><div class="doc"><p>Thentos and service sessions have a fixed duration of 2 weeks.</p><p>FIXME: make configurable, and distinguish between thentos sessions and service sessions.
 (eventually, this will need to be run-time configurable.  but there will probably still be global
 defaults handled by configifier.)</p></div></div><div class="top"><p class="src"><a name="v:lookupThentosSession" class="def">lookupThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ThentosSession">ThentosSession</a></p><div class="doc"><p>Find <code><a href="Thentos-Types.html#t:ThentosSession">ThentosSession</a></code> from token.  If <code><a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a></code> does not exist or clearance does
 not allow access, throw <code><a href="Thentos-Types.html#v:NoSuchThentosSession">NoSuchThentosSession</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:existsThentosSession" class="def">existsThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href=""/>Bool</a></p><div class="doc"><p>Like <code><a href="Thentos-Action.html#v:lookupThentosSession">lookupThentosSession</a></code>, but does not throw an exception if thentos session does not exist
 or is inaccessible, but returns <code><a href=""/>False</a></code> instead.</p></div></div><div class="top"><p class="src"><a name="v:startThentosSessionByUserId" class="def">startThentosSessionByUserId</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a></p><div class="doc"><p>Check user credentials and create a session for user.  Requires <code><a href="Thentos-Action.html#v:lookupConfirmedUser">lookupConfirmedUser</a></code> and
 <code>_startThentosSessionByAgent</code>.</p></div></div><div class="top"><p class="src"><a name="v:startThentosSessionByUserName" class="def">startThentosSessionByUserName</a> :: <a href="Thentos-Types.html#t:UserName">UserName</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a>)</p><div class="doc"><p>Like <code><a href="Thentos-Action.html#v:startThentosSessionByUserId">startThentosSessionByUserId</a></code>, but based on <code><a href="Thentos-Types.html#t:UserName">UserName</a></code> as key.</p></div></div><div class="top"><p class="src"><a name="v:startThentosSessionByUserEmail" class="def">startThentosSessionByUserEmail</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a>)</p></div><div class="top"><p class="src"><a name="v:startThentosSessionByServiceId" class="def">startThentosSessionByServiceId</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a></p><div class="doc"><p>Check service credentials and create a session for service.</p></div></div><div class="top"><p class="src"><a name="v:endThentosSession" class="def">endThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Terminate <code><a href="Thentos-Types.html#t:ThentosSession">ThentosSession</a></code>.  Does not require any label; being in possession of the session
 token is enough authentication to terminate it.</p></div></div><div class="top"><p class="src"><a name="v:validateThentosUserSession" class="def">validateThentosUserSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</p><div class="doc"><p>Check that a Thentos session exists, is not expired, and belongs to a user (rather than a
 service). Returns information on the user if that's the case. Throws <code><a href="Thentos-Types.html#v:NoSuchThentosSession">NoSuchThentosSession</a></code>
 otherwise.</p><p>We assume that the ThentosSessionToken is a secret that nobody except the session owner can
 know, therefore no special clearance is required.</p></div></div><div class="top"><p class="src"><a name="v:serviceNamesFromThentosSession" class="def">serviceNamesFromThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:ServiceName">ServiceName</a>]</p><div class="doc"><p>For a thentos session, look up all service sessions and return their service names.  Requires
 <code><a href="Thentos-Types.html#v:RoleAdmin">RoleAdmin</a></code>, service, or user privs.</p></div></div><div class="top"><p class="src"><a name="v:lookupServiceSession" class="def">lookupServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceSession">ServiceSession</a></p><div class="doc"><p>Like <code><a href="Thentos-Action.html#v:lookupThentosSession">lookupThentosSession</a></code>, but for <code><a href="Thentos-Types.html#t:ServiceSession">ServiceSession</a></code>s.</p></div></div><div class="top"><p class="src"><a name="v:existsServiceSession" class="def">existsServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href=""/>Bool</a></p><div class="doc"><p>Like <code><a href="Thentos-Action.html#v:existsThentosSession">existsThentosSession</a></code>, but for <code><a href="Thentos-Types.html#t:ServiceSession">ServiceSession</a></code>s.</p></div></div><div class="top"><p class="src"><a name="v:addServiceRegistration" class="def">addServiceRegistration</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Register a user with a service.  Requires <code><a href="Thentos-Types.html#v:RoleAdmin">RoleAdmin</a></code> or user privs.</p><p>FIXME: We do not ask for any authorization from <code><a href="Thentos-Types.html#t:ServiceId">ServiceId</a></code> as of now.  It is enough to know a
 <code><a href="Thentos-Types.html#t:ServiceId">ServiceId</a></code> to register with the resp. service.  This probably violates integrity of the view of
 the service.  Fixing this may require credentials handling.  Before we do that, we should take a
 better look at oauth.</p></div></div><div class="top"><p class="src"><a name="v:dropServiceRegistration" class="def">dropServiceRegistration</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Undo registration of a user with a service.  Requires <code><a href="Thentos-Types.html#v:RoleAdmin">RoleAdmin</a></code> or user privs.</p><p>See FIXME in <code><a href="Thentos-Action.html#v:addServiceRegistration">addServiceRegistration</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:startServiceSession" class="def">startServiceSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a></p><div class="doc"><p>Login user running the current thentos session into service.  If user is not registered with
 service, throw an error.</p><p>Inherits label and exception behavor from <code><a href="Thentos-Action.html#v:lookupThentosSession">lookupThentosSession</a></code> and write-guards for thentos
 session owner.</p></div></div><div class="top"><p class="src"><a name="v:endServiceSession" class="def">endServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p><div class="doc"><p>Terminate service session. Throws NoSuchServiceSession if the user does not
 own the session.</p></div></div><div class="top"><p class="src"><a name="v:getServiceSessionMetadata" class="def">getServiceSessionMetadata</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href="Thentos-Types.html#t:ServiceSessionMetadata">ServiceSessionMetadata</a></p><div class="doc"><p>Inherits label from <code><a href="Thentos-Action.html#v:lookupServiceSession">lookupServiceSession</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:assignRole" class="def">assignRole</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Role">Role</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p></div><div class="top"><p class="src"><a name="v:unassignRole" class="def">unassignRole</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Role">Role</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p></div><div class="top"><p class="src"><a name="v:agentRoles" class="def">agentRoles</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s [<a href="Thentos-Types.html#t:Role">Role</a>]</p></div><div class="top"><p class="src"><a name="v:makeCaptcha" class="def">makeCaptcha</a> :: <a href="Thentos-Action-Core.html#t:Action">Action</a> e s (<a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a>, <a href="Thentos-Types.html#t:ImageData">ImageData</a>)</p><div class="doc"><p>Generate a captcha. Returns a pair of <code><a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a></code> and the binary image data in PNG format.
 The correct solution to the captcha is stored in the DB. Does not require any privileges.</p></div></div><div class="top"><p class="src"><a name="v:solveCaptcha" class="def">solveCaptcha</a> :: <a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a> -&gt; ST -&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s <a href=""/>Bool</a></p><div class="doc"><p>Submit a solution to a captcha, returning whether or not the solution is correct.
 Calling this action deletes the referenced captcha from the DB, so every captcha must be
 solved (or not) at first attempt. Throws <code><a href="Thentos-Types.html#v:NoSuchCaptchaId">NoSuchCaptchaId</a></code> if the given <code><a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a></code> doesn't
 exist in the DB (either because it never did or because it was deleted due to garbage collection
 or a prior call to this action). Does not require any privileges.</p></div></div><div class="top"><p class="src"><a name="v:collectGarbage" class="def">collectGarbage</a> :: <a href=""/>Exception</a> (<a href="Thentos-Action-Core.html#t:ActionError">ActionError</a> e) =&gt; <a href="Thentos-Action-Core.html#t:Action">Action</a> e s ()</p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>