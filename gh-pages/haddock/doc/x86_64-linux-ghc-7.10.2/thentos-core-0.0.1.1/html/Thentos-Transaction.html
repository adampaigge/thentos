<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Thentos.Transaction</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Thentos-Transaction.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">thentos-core-0.0.1.1: The swiss army knife of privacy-preserving identity management</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Thentos.Transaction</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">user</a></li><li><a href="#g:2">service</a></li><li><a href="#g:3">personas, contexts, and groups</a></li><li><a href="#g:4">thentos and service session</a></li><li><a href="#g:5">agents and roles</a></li><li><a href="#g:6">Sybil attack prevention</a></li><li><a href="#g:7">garbage collection</a></li><li><a href="#g:8">helpers</a></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:lookupConfirmedUser">lookupConfirmedUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</li><li class="src short"><a href="#v:lookupAnyUser">lookupAnyUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</li><li class="src short"><a href="#v:lookupConfirmedUserByName">lookupConfirmedUserByName</a> :: <a href="Thentos-Types.html#t:UserName">UserName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</li><li class="src short"><a href="#v:lookupConfirmedUserByEmail">lookupConfirmedUserByEmail</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</li><li class="src short"><a href="#v:lookupAnyUserByEmail">lookupAnyUserByEmail</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</li><li class="src short"><a href="#v:addUserPrim">addUserPrim</a> :: <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:User">User</a> -&gt; <a href=""/>Bool</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></li><li class="src short"><a href="#v:addUser">addUser</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:User">User</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></li><li class="src short"><a href="#v:addUnconfirmedUserPrim">addUnconfirmedUserPrim</a> :: <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Types.html#t:User">User</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></li><li class="src short"><a href="#v:addUnconfirmedUser">addUnconfirmedUser</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Types.html#t:User">User</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></li><li class="src short"><a href="#v:finishUserRegistration">finishUserRegistration</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></li><li class="src short"><a href="#v:addPasswordResetToken">addPasswordResetToken</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:User">User</a></li><li class="src short"><a href="#v:resetPassword">resetPassword</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a> -&gt; <a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:addUserEmailChangeRequest">addUserEmailChangeRequest</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:confirmUserEmailChange">confirmUserEmailChange</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:changePassword">changePassword</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:deleteUser">deleteUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:allServiceIds">allServiceIds</a> :: <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>]</li><li class="src short"><a href="#v:lookupService">lookupService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>, <a href="Thentos-Types.html#t:Service">Service</a>)</li><li class="src short"><a href="#v:addService">addService</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a> -&gt; <a href="Thentos-Types.html#t:ServiceName">ServiceName</a> -&gt; <a href="Thentos-Types.html#t:ServiceDescription">ServiceDescription</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:deleteService">deleteService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:registerUserWithService">registerUserWithService</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ServiceAccount">ServiceAccount</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:unregisterUserFromService">unregisterUserFromService</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:addPersona">addPersona</a> :: <a href="Thentos-Types.html#t:PersonaName">PersonaName</a> -&gt; <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:Uri">Uri</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:Persona">Persona</a></li><li class="src short"><a href="#v:deletePersona">deletePersona</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:addContext">addContext</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Types.html#t:ContextDescription">ContextDescription</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:ProxyUri">ProxyUri</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:Context">Context</a></li><li class="src short"><a href="#v:deleteContext">deleteContext</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:findContextId">findContextId</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href=""/>Maybe</a> <a href="Thentos-Types.html#t:ContextId">ContextId</a>)</li><li class="src short"><a href="#v:registerPersonaWithContext">registerPersonaWithContext</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:unregisterPersonaFromContext">unregisterPersonaFromContext</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:findPersona">findPersona</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href=""/>Maybe</a> <a href="Thentos-Types.html#t:Persona">Persona</a>)</li><li class="src short"><a href="#v:contextsForService">contextsForService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:Context">Context</a>]</li><li class="src short"><a href="#v:addPersonaToGroup">addPersonaToGroup</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:removePersonaFromGroup">removePersonaFromGroup</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:addGroupToGroup">addGroupToGroup</a> :: <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:removeGroupFromGroup">removeGroupFromGroup</a> :: <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:personaGroups">personaGroups</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:Group">Group</a>]</li><li class="src short"><a href="#v:lookupThentosSession">lookupThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a>, <a href="Thentos-Types.html#t:ThentosSession">ThentosSession</a>)</li><li class="src short"><a href="#v:startThentosSession">startThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:endThentosSession">endThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:serviceNamesFromThentosSession">serviceNamesFromThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:ServiceName">ServiceName</a>]</li><li class="src short"><a href="#v:lookupServiceSession">lookupServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a>, <a href="Thentos-Types.html#t:ServiceSession">ServiceSession</a>)</li><li class="src short"><a href="#v:startServiceSession">startServiceSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:endServiceSession">endServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:assignRole">assignRole</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Role">Role</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:unassignRole">unassignRole</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Role">Role</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:agentRoles">agentRoles</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:Role">Role</a>]</li><li class="src short"><a href="#v:storeCaptcha">storeCaptcha</a> :: <a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a> -&gt; ST -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:solveCaptcha">solveCaptcha</a> :: <a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a> -&gt; ST -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href=""/>Bool</a></li><li class="src short"><a href="#v:garbageCollectThentosSessions">garbageCollectThentosSessions</a> :: <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:garbageCollectServiceSessions">garbageCollectServiceSessions</a> :: <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:garbageCollectUnconfirmedUsers">garbageCollectUnconfirmedUsers</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:garbageCollectPasswordResetTokens">garbageCollectPasswordResetTokens</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:garbageCollectEmailChangeTokens">garbageCollectEmailChangeTokens</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:garbageCollectCaptchas">garbageCollectCaptchas</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</li><li class="src short"><a href="#v:impossible">impossible</a> :: <a href=""/>String</a> -&gt; a</li><li class="src short"><a href="#v:makeAgent">makeAgent</a> :: <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:Agent">Agent</a></li></ul></div><div id="interface"><h1 id="g:1">user</h1><div class="top"><p class="src"><a name="v:lookupConfirmedUser" class="def">lookupConfirmedUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</p></div><div class="top"><p class="src"><a name="v:lookupAnyUser" class="def">lookupAnyUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</p><div class="doc"><p>Lookup any user (whether confirmed or not) by their ID.</p></div></div><div class="top"><p class="src"><a name="v:lookupConfirmedUserByName" class="def">lookupConfirmedUserByName</a> :: <a href="Thentos-Types.html#t:UserName">UserName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</p></div><div class="top"><p class="src"><a name="v:lookupConfirmedUserByEmail" class="def">lookupConfirmedUserByEmail</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</p></div><div class="top"><p class="src"><a name="v:lookupAnyUserByEmail" class="def">lookupAnyUserByEmail</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:UserId">UserId</a>, <a href="Thentos-Types.html#t:User">User</a>)</p><div class="doc"><p>Lookup any user (whether confirmed or not) by their email address.</p></div></div><div class="top"><p class="src"><a name="v:addUserPrim" class="def">addUserPrim</a> :: <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:User">User</a> -&gt; <a href=""/>Bool</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></p><div class="doc"><p>Actually add a new user. The user may already have an ID, otherwise the DB will automatically
 create one (auto-increment). NOTE that mixing calls with <code><a href=""/>Just</a></code> an ID with those without
 is a very bad idea and will quickly lead to errors!</p></div></div><div class="top"><p class="src"><a name="v:addUser" class="def">addUser</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:User">User</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></p><div class="doc"><p>Add a new user and return the new user's <code><a href="Thentos-Types.html#t:UserId">UserId</a></code>.
 Ensures that user name and email address are unique.</p></div></div><div class="top"><p class="src"><a name="v:addUnconfirmedUserPrim" class="def">addUnconfirmedUserPrim</a> :: <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Types.html#t:User">User</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></p></div><div class="top"><p class="src"><a name="v:addUnconfirmedUser" class="def">addUnconfirmedUser</a> :: (<a href=""/>Show</a> e, <a href=""/>Typeable</a> e) =&gt; <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Types.html#t:User">User</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></p><div class="doc"><p>Add a new unconfirmed user (i.e. one whose email address we haven't confirmed yet).
 Ensures that user name and email address are unique.</p></div></div><div class="top"><p class="src"><a name="v:finishUserRegistration" class="def">finishUserRegistration</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:UserId">UserId</a></p></div><div class="top"><p class="src"><a name="v:addPasswordResetToken" class="def">addPasswordResetToken</a> :: <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:User">User</a></p><div class="doc"><p>Add a password reset token.  Return the user whose password this token can change.</p></div></div><div class="top"><p class="src"><a name="v:resetPassword" class="def">resetPassword</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Types.html#t:PasswordResetToken">PasswordResetToken</a> -&gt; <a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Change a password with a given password reset token and remove the token.  Throw an error if
 the token does not exist or has expired.</p></div></div><div class="top"><p class="src"><a name="v:addUserEmailChangeRequest" class="def">addUserEmailChangeRequest</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:UserEmail">UserEmail</a> -&gt; <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p></div><div class="top"><p class="src"><a name="v:confirmUserEmailChange" class="def">confirmUserEmailChange</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Types.html#t:ConfirmationToken">ConfirmationToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Change email with a given token and remove the token.  Throw an error if the token does not
 exist or has expired.</p></div></div><div class="top"><p class="src"><a name="v:changePassword" class="def">changePassword</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:UserPass">UserPass</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Change password. Should only be called once the old password has been
 verified.</p></div></div><div class="top"><p class="src"><a name="v:deleteUser" class="def">deleteUser</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Delete user with given <code><a href="Thentos-Types.html#t:UserId">UserId</a></code>.  Throw an error if user does not exist.</p></div></div><h1 id="g:2">service</h1><div class="top"><p class="src"><a name="v:allServiceIds" class="def">allServiceIds</a> :: <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>]</p></div><div class="top"><p class="src"><a name="v:lookupService" class="def">lookupService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:ServiceId">ServiceId</a>, <a href="Thentos-Types.html#t:Service">Service</a>)</p></div><div class="top"><p class="src"><a name="v:addService" class="def">addService</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:HashedSecret">HashedSecret</a> <a href="Thentos-Types.html#t:ServiceKey">ServiceKey</a> -&gt; <a href="Thentos-Types.html#t:ServiceName">ServiceName</a> -&gt; <a href="Thentos-Types.html#t:ServiceDescription">ServiceDescription</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Add new service.</p></div></div><div class="top"><p class="src"><a name="v:deleteService" class="def">deleteService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Delete service with given <code><a href="Thentos-Types.html#t:ServiceId">ServiceId</a></code>.  Throw an error if service does not exist.</p></div></div><div class="top"><p class="src"><a name="v:registerUserWithService" class="def">registerUserWithService</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ServiceAccount">ServiceAccount</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p></div><div class="top"><p class="src"><a name="v:unregisterUserFromService" class="def">unregisterUserFromService</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p></div><h1 id="g:3">personas, contexts, and groups</h1><div class="top"><p class="src"><a name="v:addPersona" class="def">addPersona</a> :: <a href="Thentos-Types.html#t:PersonaName">PersonaName</a> -&gt; <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:Uri">Uri</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:Persona">Persona</a></p><div class="doc"><p>Add a new persona to the DB. A persona has a unique name and a user to which it belongs.
 The <code><a href="Thentos-Types.html#t:PersonaId">PersonaId</a></code> is assigned by the DB. May throw <code><a href="Thentos-Types.html#v:NoSuchUser">NoSuchUser</a></code> or <code><a href="Thentos-Types.html#v:PersonaNameAlreadyExists">PersonaNameAlreadyExists</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:deletePersona" class="def">deletePersona</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Delete a persona. Throw <code><a href="Thentos-Types.html#v:NoSuchPersona">NoSuchPersona</a></code> if the persona does not exist in the DB.</p></div></div><div class="top"><p class="src"><a name="v:addContext" class="def">addContext</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Types.html#t:ContextDescription">ContextDescription</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:ProxyUri">ProxyUri</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href="Thentos-Types.html#t:Context">Context</a></p><div class="doc"><p>Add a new context. The first argument identifies the service to which the context belongs.
 May throw <code><a href="Thentos-Types.html#v:NoSuchService">NoSuchService</a></code> or <code><a href="Thentos-Types.html#v:ContextNameAlreadyExists">ContextNameAlreadyExists</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:deleteContext" class="def">deleteContext</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Delete a context. Throw an error if the context does not exist in the DB.</p></div></div><div class="top"><p class="src"><a name="v:findContextId" class="def">findContextId</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href=""/>Maybe</a> <a href="Thentos-Types.html#t:ContextId">ContextId</a>)</p></div><div class="top"><p class="src"><a name="v:registerPersonaWithContext" class="def">registerPersonaWithContext</a> :: <a href="Thentos-Types.html#t:Persona">Persona</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p></div><div class="top"><p class="src"><a name="v:unregisterPersonaFromContext" class="def">unregisterPersonaFromContext</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p></div><div class="top"><p class="src"><a name="v:findPersona" class="def">findPersona</a> :: <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:ContextName">ContextName</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href=""/>Maybe</a> <a href="Thentos-Types.html#t:Persona">Persona</a>)</p></div><div class="top"><p class="src"><a name="v:contextsForService" class="def">contextsForService</a> :: <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:Context">Context</a>]</p></div><div class="top"><p class="src"><a name="v:addPersonaToGroup" class="def">addPersonaToGroup</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Add a persona to a group. If the persona is already a member of the group, do nothing.</p></div></div><div class="top"><p class="src"><a name="v:removePersonaFromGroup" class="def">removePersonaFromGroup</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Remove a persona from a group. If the persona is not a member of the group, do nothing.</p></div></div><div class="top"><p class="src"><a name="v:addGroupToGroup" class="def">addGroupToGroup</a> :: <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Add a group (subgroup) to another group (supergroup) so that all members of subgroup will also
 be considered members of supergroup. If subgroup is already a direct member of supergroup, do
 nothing. Throws <code><a href="Thentos-Types.html#v:GroupMembershipLoop">GroupMembershipLoop</a></code> if adding the relation would cause a loop.</p></div></div><div class="top"><p class="src"><a name="v:removeGroupFromGroup" class="def">removeGroupFromGroup</a> :: <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Types.html#t:Group">Group</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Remove a group (subgroup) from another group (supergroup). If subgroup is not a direct
 member of supergroup, do nothing.</p></div></div><div class="top"><p class="src"><a name="v:personaGroups" class="def">personaGroups</a> :: <a href="Thentos-Types.html#t:PersonaId">PersonaId</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:Group">Group</a>]</p><div class="doc"><p>List all groups a persona belongs to, directly or indirectly. If p is a member of g1,
 g1 is a member of g2, and g2 is a member of g3, [g1, g2, g3] will be returned.</p></div></div><h1 id="g:4">thentos and service session</h1><div class="top"><p class="src"><a name="v:lookupThentosSession" class="def">lookupThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a>, <a href="Thentos-Types.html#t:ThentosSession">ThentosSession</a>)</p><div class="doc"><p>Lookup session.  If session does not exist or has expired, throw an error.  If it does exist,
 bump the expiry time and return session with bumped expiry time.</p></div></div><div class="top"><p class="src"><a name="v:startThentosSession" class="def">startThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Start a new thentos session. Start time is set to now, end time is calculated based on the
 specified <code><a href="Thentos-Types.html#t:Timeout">Timeout</a></code>. If the agent is a user, this new session is added to their existing
 sessions. Only confirmed users are allowed to log in; a <code><a href="Thentos-Types.html#v:NoSuchUser">NoSuchUser</a></code> error is thrown otherwise.
 FIXME not implemented: If the agent is a service with an existing session, its session is
 replaced.</p></div></div><div class="top"><p class="src"><a name="v:endThentosSession" class="def">endThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>End thentos session and all associated service sessions.
 If thentos session does not exist or has expired, remove it just the same.</p><p>Always call this transaction if you want to clean up a session (e.g., from a garbage collection
 transaction).  This way in the future, you can replace this transaction easily by one that does
 not actually destroy the session, but move it to an archive.</p></div></div><div class="top"><p class="src"><a name="v:serviceNamesFromThentosSession" class="def">serviceNamesFromThentosSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:ServiceName">ServiceName</a>]</p><div class="doc"><p>Get the names of all services that a given thentos session is signed into</p></div></div><div class="top"><p class="src"><a name="v:lookupServiceSession" class="def">lookupServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e (<a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a>, <a href="Thentos-Types.html#t:ServiceSession">ServiceSession</a>)</p><div class="doc"><p>Like <code><a href="Thentos-Transaction.html#v:lookupThentosSession">lookupThentosSession</a></code>, but for <code><a href="Thentos-Types.html#t:ServiceSession">ServiceSession</a></code>.  Bump both service and associated
 thentos session.  If the service session is still active, but the associated thentos session has
 expired, update service sessions expiry time to <code>now</code> and throw <code><a href="Thentos-Types.html#v:NoSuchThentosSession">NoSuchThentosSession</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:startServiceSession" class="def">startServiceSession</a> :: <a href="Thentos-Types.html#t:ThentosSessionToken">ThentosSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Like <code><a href="Thentos-Transaction.html#v:startThentosSession">startThentosSession</a></code> for service sessions.  Bump associated thentos session.  Throw an
 error if thentos session lookup fails.  If a service session already exists for the given
 <code><a href="Thentos-Types.html#t:ServiceId">ServiceId</a></code>, return its token.</p></div></div><div class="top"><p class="src"><a name="v:endServiceSession" class="def">endServiceSession</a> :: <a href="Thentos-Types.html#t:ServiceSessionToken">ServiceSessionToken</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Like <code><a href="Thentos-Transaction.html#v:endThentosSession">endThentosSession</a></code> for service sessions (see there).  If thentos session or service
 session do not exist or have expired, remove the service session just the same, but never thentos
 session.</p></div></div><h1 id="g:5">agents and roles</h1><div class="top"><p class="src"><a name="v:assignRole" class="def">assignRole</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Role">Role</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Add a new role to the roles defined for an <code><a href="Thentos-Types.html#t:Agent">Agent</a></code>.  If <code><a href="Thentos-Types.html#t:Role">Role</a></code> is already assigned to
 <code><a href="Thentos-Types.html#t:Agent">Agent</a></code>, do nothing.</p></div></div><div class="top"><p class="src"><a name="v:unassignRole" class="def">unassignRole</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Types.html#t:Role">Role</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Remove a <code><a href="Thentos-Types.html#t:Role">Role</a></code> from the roles defined for an <code><a href="Thentos-Types.html#t:Agent">Agent</a></code>.  If <code><a href="Thentos-Types.html#t:Role">Role</a></code> is not assigned to <code><a href="Thentos-Types.html#t:Agent">Agent</a></code>,
 do nothing.</p></div></div><div class="top"><p class="src"><a name="v:agentRoles" class="def">agentRoles</a> :: <a href="Thentos-Types.html#t:Agent">Agent</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e [<a href="Thentos-Types.html#t:Role">Role</a>]</p><div class="doc"><p>All <code><a href="Thentos-Types.html#t:Role">Role</a></code>s of an <code><a href="Thentos-Types.html#t:Agent">Agent</a></code>.  If <code><a href="Thentos-Types.html#t:Agent">Agent</a></code> does not exist or has no roles, return an empty list.</p></div></div><h1 id="g:6">Sybil attack prevention</h1><div class="top"><p class="src"><a name="v:storeCaptcha" class="def">storeCaptcha</a> :: <a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a> -&gt; ST -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Store the solution to a captcha in the DB. May throw <code><a href="Thentos-Types.html#v:CaptchaIdAlreadyExists">CaptchaIdAlreadyExists</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:solveCaptcha" class="def">solveCaptcha</a> :: <a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a> -&gt; ST -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e <a href=""/>Bool</a></p><div class="doc"><p>Submit a solution to a captcha, returning whether or not the solution is correct.
 Calling this action deletes the referenced captcha from the DB, so every captcha must be
 solved (or not) at first attempt. Throws <code><a href="Thentos-Types.html#v:NoSuchCaptchaId">NoSuchCaptchaId</a></code> if the given <code><a href="Thentos-Types.html#t:CaptchaId">CaptchaId</a></code> doesn't
 exist in the DB (either because it never did or because it was deleted due to garbage collection
 or a prior call to this action).</p></div></div><h1 id="g:7">garbage collection</h1><div class="top"><p class="src"><a name="v:garbageCollectThentosSessions" class="def">garbageCollectThentosSessions</a> :: <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Go through &quot;thentos_sessions&quot; table and find all expired sessions.</p></div></div><div class="top"><p class="src"><a name="v:garbageCollectServiceSessions" class="def">garbageCollectServiceSessions</a> :: <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p></div><div class="top"><p class="src"><a name="v:garbageCollectUnconfirmedUsers" class="def">garbageCollectUnconfirmedUsers</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Remove all expired unconfirmed users from db.</p></div></div><div class="top"><p class="src"><a name="v:garbageCollectPasswordResetTokens" class="def">garbageCollectPasswordResetTokens</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Remove all expired password reset requests from db.</p></div></div><div class="top"><p class="src"><a name="v:garbageCollectEmailChangeTokens" class="def">garbageCollectEmailChangeTokens</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Remove all expired email change requests from db.</p></div></div><div class="top"><p class="src"><a name="v:garbageCollectCaptchas" class="def">garbageCollectCaptchas</a> :: <a href="Thentos-Types.html#t:Timeout">Timeout</a> -&gt; <a href="Thentos-Transaction-Core.html#t:ThentosQuery">ThentosQuery</a> e ()</p><div class="doc"><p>Remove all expired captchas from db.</p></div></div><h1 id="g:8">helpers</h1><div class="top"><p class="src"><a name="v:impossible" class="def">impossible</a> :: <a href=""/>String</a> -&gt; a</p><div class="doc"><p>Throw an error from a situation which (we believe) will never arise.</p></div></div><div class="top"><p class="src"><a name="v:makeAgent" class="def">makeAgent</a> :: <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:UserId">UserId</a> -&gt; <a href=""/>Maybe</a> <a href="Thentos-Types.html#t:ServiceId">ServiceId</a> -&gt; <a href="Thentos-Types.html#t:Agent">Agent</a></p><div class="doc"><p>Given either a UserId or a ServiceId, return an Agent.  Throws an error if not exactly one of
 the arguments is <code><a href=""/>Just</a></code> (totality enforced by constraint on `services.owner_{user,service}`).
 Useful for getting an Agent from the database.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>